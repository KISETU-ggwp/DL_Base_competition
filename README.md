# 松尾・松澤研究室 深層学習_最終課題レポート(VQA)

筑波技術大学 船山滉介

## 1. はじめに

Visual Question Answering (VQA) は、与えられた画像に関する自然言語の質問に答えるタスクである。本レポートでは、VQAタスクの実装について、データの前処理からモデルの構築、トレーニング、評価まで包括的に解説する。

## 2. データの前処理

### 2.1 データセットの構造

データセットは主に4つのファイルから構成される。

- train.json: 訓練データのjsonファイルであり、画像のパス、質問文、回答文がjson形式でまとめられている。
- valid.json: テストデータのjsonファイルで、画像のパスと質問文がjson形式で記述されている。
- train.zip: 訓練データの画像ファイル。
- valid.zip: テストデータの画像ファイル。

### 2.2 テキストの前処理・回答の処理・画像の前処理

前処理については、特に変更を加えずベースラインコードをそのまま使用した。回答の処理に関しては、頻出上位3000の回答をクラスとして使用した。複数回答の統合においては、最頻出の回答を正解とすることでコンフリクトを回避した。画像の前処理として、先行研究を参考に224x224ピクセルにリサイズし、ImageNetの平均と標準偏差を用いて正規化を行った。

## 3. VQAModelクラス

VQAModelクラスは、画像と質問を入力として受け取り、適切な回答を予測するものである。このクラスは以下の3つの主要部分から構成されている。

1. **画像エンコーダー**
   - ResNet18を使用して画像特徴を抽出
   - 入力画像を512次元の特徴ベクトルに変換

2. **テキストエンコーダー**
   - 埋め込み層、線形層、ReLU活性化関数で構成
   - 質問文を512次元の特徴ベクトルに変換
   - パディングを考慮した平均化処理により、異なる長さの質問を効果的に処理

3. **特徴融合ネットワーク**
   - 画像特徴と質問特徴を結合し、最終的な回答を予測
   - 2層の全結合層で構成

モデルの順伝播では、以下の手順で処理が行われる：

1. 画像特徴の抽出
2. 質問特徴の抽出
3. 特徴の結合（concatenation）
4. 融合ネットワークを通じた回答の予測

## 4. トレーニングと評価

本研究のVQAモデルのトレーニングと評価プロセスでは、効率的な学習と正確な性能評価を目指して様々な工夫を行った。

損失関数には多クラス分類問題に適したCrossEntropyLossを採用した。この関数はソフトマックス関数と負の対数尤度損失を組み合わせており、計算効率が良いという利点がある。最適化にはAdamオプティマイザーを使用し、学習率を0.001、weight decayを1e-5に設定した。Adamは勾配の1次と2次モーメントを適応的に調整するため学習が安定しやすく、またハイパーパラメータのチューニングが比較的容易であることから選択した。

トレーニングループでは、各エポックでモデルを訓練モードに設定し、損失、精度、単純精度、訓練時間を記録した。これらの指標をリアルタイムで出力することで、学習の進捗を詳細に監視することができた。

評価指標としては、VQA_criterionとシンプルな精度の2つを実装した。VQA_criterionは複数の正解がある場合を考慮した評価指標で、予測が複数の人間の回答とどの程度一致しているかを評価する。一方、シンプルな精度は最頻の回答との一致を評価する単純な指標だが、モデルの基本的な性能を把握するのに有用である。

最後に、検証と予測生成のプロセスでは、モデルを評価モードに設定し、テストデータに対して予測を生成した。生成された予測は実際の回答に変換され、最終的に結果をファイルに保存した。このプロセスにより、モデルの汎化性能を評価し、未知のデータに対する予測を生成することができた。

このようなトレーニングと評価のアプローチにより、モデルの性能を正確に把握し、改善点を明確にすることができた。

## 5. 結果
0.4414771583819665


## 6. 改善点

本研究のさらなる発展のためには、トランスフォーマーベースの質問エンコーダーの導入や、注意機構を用いた特徴融合方法の実装が考えられる。これらの改善により、より優れた結果が得られる可能性がある。
